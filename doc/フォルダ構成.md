# Time Tracker Go - フォルダ構成

**作成者:** AI Assistant  
**作成日:** 2025-01-27  
**ステータス:** 確定  
**バージョン:** 1.0

## 概要

本文書では、ドメイン駆動設計（DDD）とテスト駆動開発（TDD）に基づくTime Tracker Goアプリケーションのフォルダ構成について説明します。Tauriフレームワークを使用し、RustバックエンドとReact/TypeScriptフロントエンドで構成されています。

## 全体構成

```
time_tracking/
├── doc/                          # ドキュメント
├── src/                          # フロントエンド（React + TypeScript）
├── src-tauri/                    # バックエンド（Rust）
├── tests/                        # テストコード
├── database/                     # データベース関連
├── scripts/                      # スクリプト
├── README.md                     # プロジェクト説明
└── .gitignore                    # Git除外設定
```

## 1. バックエンド構成（src-tauri/）

### DDDの4層アーキテクチャ

```
src-tauri/src/
├── lib.rs                        # ライブラリエントリーポイント
├── domain/                       # ドメイン層
│   ├── mod.rs
│   ├── entities/                 # エンティティ
│   │   └── mod.rs
│   ├── value_objects/            # 値オブジェクト
│   │   └── mod.rs
│   ├── repositories/             # リポジトリトレイト
│   │   └── mod.rs
│   └── services/                 # ドメインサービス
│       └── mod.rs
├── application/                  # アプリケーション層
│   ├── mod.rs
│   ├── use_cases/                # ユースケース
│   │   └── mod.rs
│   ├── dto/                      # データ転送オブジェクト
│   │   └── mod.rs
│   └── services/                 # アプリケーションサービス
│       └── mod.rs
├── infrastructure/              # インフラ層
│   ├── mod.rs
│   ├── database/                # データベース関連
│   │   └── mod.rs
│   ├── repositories/            # リポジトリ実装
│   │   └── mod.rs
│   └── config/                  # 設定管理
│       └── mod.rs
└── presentation/                # プレゼンテーション層
    ├── mod.rs
    └── commands/                # Tauriコマンド
        └── mod.rs
```

### 各層の責務

#### ドメイン層（domain/）
- **entities/**: プロジェクト、タスク、時間エントリ、タグなどのエンティティ
- **value_objects/**: ID、ステータス、時間範囲、期間などの値オブジェクト
- **repositories/**: データ永続化の抽象化インターフェース
- **services/**: エンティティに属さないビジネスロジック

#### アプリケーション層（application/）
- **use_cases/**: プロジェクト管理、タスク管理、時間計測、レポート生成などのユースケース
- **dto/**: 層間でのデータ受け渡し用オブジェクト
- **services/**: ユースケース調整、クエリサービス、バリデーションサービス

#### インフラ層（infrastructure/）
- **database/**: SQLite接続、マイグレーション、ビュー管理
- **repositories/**: ドメインリポジトリトレイトの具体実装
- **config/**: アプリケーション設定、データベース設定、ログ設定

#### プレゼンテーション層（presentation/）
- **commands/**: Tauriコマンド（フロントエンドとの橋渡し）

## 2. フロントエンド構成（src/）

```
src/
├── components/                   # UIコンポーネント
│   ├── common/                   # 共通コンポーネント
│   │   └── index.ts              # Button, Input, Modal, Layout等
│   ├── projects/                 # プロジェクト関連
│   │   └── index.ts              # ProjectList, ProjectCard, ProjectForm等
│   ├── tasks/                    # タスク関連
│   │   └── index.ts              # TaskList, TaskCard, TaskForm等
│   ├── time_tracking/            # 時間計測関連
│   │   └── index.ts              # Timer, TimerControls, TimeEntryList等
│   └── reports/                  # レポート関連
│       └── index.ts              # ReportDashboard, TimeChart等
├── hooks/                        # カスタムフック
│   └── index.ts                  # useProjects, useTasks, useTimeTracking等
├── services/                     # API通信
│   └── index.ts                  # projectService, taskService等
├── types/                        # 型定義
│   └── index.ts                  # Project, Task, TimeEntry, Tag等
└── utils/                        # ユーティリティ
    └── index.ts                  # dateUtils, formatUtils等
```

### 各フォルダの責務

#### components/
- **common/**: アプリケーション全体で再利用可能なUI要素
- **projects/**: プロジェクト管理画面のコンポーネント
- **tasks/**: タスク管理画面のコンポーネント
- **time_tracking/**: タイマー機能と時間記録のコンポーネント
- **reports/**: レポート表示のコンポーネント

#### hooks/
- React カスタムフック（状態管理とビジネスロジックの再利用）

#### services/
- Tauriコマンドとの通信を抽象化したサービス層

#### types/
- TypeScript型定義（フロントエンド全体で使用）

#### utils/
- 汎用的なヘルパー関数

## 3. テスト構成（tests/）

```
tests/
├── unit/                         # ユニットテスト
│   ├── domain/                   # ドメイン層テスト
│   │   └── mod.rs
│   ├── application/              # アプリケーション層テスト
│   │   └── mod.rs
│   └── infrastructure/          # インフラ層テスト
│       └── mod.rs
├── integration/                  # 統合テスト
│   └── api_tests.rs              # Tauriコマンド統合テスト
└── e2e/                          # E2Eテスト
    ├── playwright.config.ts      # Playwright設定
    └── specs/                    # テストスペック
        └── time_tracking.spec.ts # タイムトラッキング機能テスト
```

### テスト戦略

#### ユニットテスト
- **ドメイン層**: エンティティ、値オブジェクト、ドメインサービスのテスト
- **アプリケーション層**: ユースケース、アプリケーションサービスのテスト
- **インフラ層**: リポジトリ実装、データベース操作のテスト

#### 統合テスト
- Tauriコマンドを通じたフロントエンド・バックエンド連携テスト

#### E2Eテスト
- Playwrightによる実際のユーザー操作シミュレーション
- 主要ユーザーフロー（プロジェクト作成、タイマー操作等）の自動化テスト

## 4. データベース構成（database/）

```
database/
├── migrations/                   # マイグレーション
│   ├── 001_initial_schema.sql    # 初期スキーマ
│   └── 002_views.sql             # ビュー定義
└── seeds/                        # サンプルデータ
    └── sample_data.sql           # 開発・テスト用データ
```

### マイグレーション管理

#### 001_initial_schema.sql
- 基本テーブル定義（イミュータブルデータモデル）
- インデックス定義
- 制約定義

#### 002_views.sql
- 現在値導出用ビュー（task_current_view, time_entries_view, task_tags_current）

#### seeds/sample_data.sql
- 開発・テスト用のサンプルデータ

## 5. スクリプト（scripts/）

```
scripts/
└── (将来の運用スクリプト用)
```

データベースメンテナンス、バックアップ、デプロイ等のスクリプトを配置する予定。

## 6. 設計原則とベストプラクティス

### DDDの適用

1. **関心の分離**: 各層が明確な責務を持つ
2. **依存方向**: 外側の層が内側の層に依存（依存性逆転の原則）
3. **ドメイン知識の表現**: ビジネスルールをコードで明確に表現

### テスト駆動開発（TDD）

1. **テストファースト**: 実装前にテストを作成
2. **テストカバレッジ**: 各層のテストを網羅的に実施
3. **自動化**: CI/CDパイプラインでの自動テスト実行

### コード組織化

1. **モジュール分割**: 機能別の明確な分割
2. **再利用性**: 共通コンポーネント・関数の抽出
3. **型安全性**: TypeScriptによる型チェック

## 7. 今後の拡張性

### 新機能追加時の指針

1. **ドメイン機能**: domainフォルダに新しいエンティティ・サービスを追加
2. **UI機能**: componentsフォルダに機能別コンポーネントを追加
3. **API機能**: presentation/commandsに新しいTauriコマンドを追加

### マイグレーション戦略

1. **スキーマ変更**: database/migrationsに新しいマイグレーションファイルを追加
2. **データ移行**: 既存データの互換性を保ちながら段階的に移行

## まとめ

このフォルダ構成は、保守性・拡張性・テスタビリティを重視したドメイン駆動設計に基づいています。各層が明確に分離され、ビジネスロジックがドメイン層に集約されることで、長期的な開発・運用に適した構造となっています。

テスト駆動開発に対応した構造により、品質を保ちながら安全に機能追加・変更を行うことが可能です。
